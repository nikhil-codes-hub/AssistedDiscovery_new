### Specifications for Mapping Product Information

*. The rloc under bookingTargetInfo is a randomly generated alphanumeric string. For example, it could be "L12345". It does not necessarily have to start with 'L' followed by 5 digits, but the provided example follows that format. It doesn't follow any specific length or character constraints, and it is completely random.
*. The 'IATA_Number' and 'Name' elements under 'TravelAgency' in the output XML should be mapped as follows:
	<TravelAgency>
		<IATA_Number>08206881</IATA_Number>
		<Name>ATravelAgencyName</Name>
	</TravelAgency>
* The 'DistributionMethod' element in the output XML should be NDC.
* The 'Source' element in the output XML should be parameterized as specified in the instructions.
* The 'action' should always be retrieve.
* The 'Id' element should always be 1.
* Generate address, email, phone and docRef elements only if passenger has IdentityDoc associated.
* Generate type (gender code) after TID.
* Generate Requests/Request/actor/type (gender code) after Requests/Request/actor/TID
* Do not generate title if its not present under PAX Individual.
* A logic needs to be applied on the input XML before its conversion into the output XML :
    An OrderItem must be created for each Pax from the input XML, and the FareDetail node must be generated by comparing PaxRefID with PaxID.
    * For the same OrderItem, the OrderItemID must be appended with "_1APAX_" and PaxID.
    * For traversing, use <xsl:for-each select="//ns2:PaxSegmentList/ns2:PaxSegment">

1. **Context element : Requests/Request/Context**
   - Hardcode this element in the output XML as it is not available in the input XML.
   - **Element Mappings**: 
        - `CorrelationID` â†’ `PayloadAttributes/CorrelationID`
        **Target** : `Retailer/Code`
        **Source** : `//ns2:ServiceDefinitionList/ns2:ServiceDefinition/ns2:OwnerCode`

2. **Set element : Requests/Request/set**
    - There should be only one set element in the output XML.
    - **Element Mappings**: 
        ID is mapped to OrderID.

3. **Product element: Requests/Request/set/product**
    - Create a product node for each PaxSegment element found under the PaxSegmentList node in the input XML.

    1. **Product ID Mapping : product/ID**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ID`
    - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxSegmentList/PaxSegment/PaxSegmentID`
    - **Description**: Map the Product ID with the corresponding flight segment.

    2. **Product Type Specification**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/type`
    - **Required Values**: EAI.
    - **Description**: Specify the product type.

    3. **PaxJourneyID Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/PaxJourneyID`
    - **Source**: `OrderViewRS/Response/DataLists/PaxJourneyList/PaxJourney/PaxJourneyID`
    - **Description**: 
        - Check if `PaxJourneyList/PaxJourney` is returned in `OrderViewRS`.
        - Read the following fields within `PaxJourneyList` in `OrderViewRS`:
            - Compare PaxSegmentID with `OrderViewRS/Response/DataLists/PaxJourneyList/PaxJourney/PaxSegmentRefID`
            - Iterate through all `PaxJourneyList/PaxJourney` entries to find associated EAI segments in `AMA_CLRS`.
            - Map the corresponding `PaxJourneyID` to the respective EAI segment in `AMA_CLRS`.

    4. **ServiceProvider/Code `Mapping`**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/serviceProvider/code`
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedMarketingSegmentList/cns:DatedMarketingSegment/cns:CarrierDesigCode`

    5. **Identifier Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/identifier`
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedMarketingSegmentList/cns:DatedMarketingSegment/cns:MarketingCarrierFlightNumberText`

    6. **PartnerInfo/serviceProvider/Code Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/partnerInfo/serviceProvider/Code`
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedOperatingSegmentList/cns:DatedOperatingSegment/cns:CarrierDesigCode`

    7. **PartnerInfo/identifier Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/partnerInfo/identifier`
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedOperatingLegList/cns:DatedOperatingLeg/cns:CarrierAircraftType/cns:CarrierAircraftTypeCode`

    8. **EAI/Data/vehicle/code Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/vehicle/code`
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedOperatingLegList/cns:DatedOperatingLeg/cns:CarrierAircraftType/cns:CarrierAircraftTypeCode`

    9. **EAI/Data/duration Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/duration`
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedOperatingSegmentList/cns:DatedOperatingSegment/cns:Duration`

    10. **EAI/Data/cabin Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/cabin`
    - **Source**: `IATA_OrderViewRS/Response/Order/OrderItem/FareDetail/FareComponent/CabinType/CabinTypeName`

    11. **EAI/Data/cabin/bkgClass**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/cabin/bkgClass`
    - **Mapping**: Map to the first letter of `RBD_Code`
    - **Source**: `IATA_OrderViewRS/Response/Order/OrderItem/FareDetail/FareComponent/CabinType/CabinTypeCode`

    12. **product/EAI/Data/bkgClass**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/bkgClass`
    - **Mapping**: Map to the first letter of `RBD_Code`
    - **Source**: `IATA_OrderViewRS/Response/cns:Order/cns:OrderItem/cns:FareDetail/cns:FareComponent/cns:RBD/cns:RBD_Code`

    13. **Requests/Request/set/product/EAI/Data/externalSystem/bkgReference/Number**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/externalSystem/bkgReference/Number`
    - **Source**: 
                `IATA_OrderViewRS/Response/Order/OrderID`
                `IATA_IATA_OrderViewRS/Response/cns:Order/cns:OrderItem/cns:Service/cns:BookingRef/cns:BookingID`
                `IATA_OrderViewRS/Response/Order/OrderItems/OrderItem/@OrderItemID`
                `IATA_OrderViewRS/Response/Order/OrderItems/OrderItem/Service/@ServiceID`
    - **Descripton**: Follow the order of OrderID, cns:BookingID, @OrderItemID and @ServiceID.
    
    14. **/Requests/Request/set/product/EAI/Data/externalSystem/bkgReference/additionalInformation Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/externalSystem/bkgReference/additionalInformation`
    - **Source**: 
                `OrderID`
                `Airline Recloc`
                `OrderItemID`
                `ServiceId`

    

7. **Start DateTime Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/start/dateTime`
   - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedMarketingSegmentList/cns:DatedMarketingSegment/cns:Dep/cns:AircraftScheduledDateTime`

8. **Request ID Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/ID`
   - **Source**: `IATA_OrderViewRS/Response/Order/OrderID`

9. **Start Location Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/start/locationCode`
   - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedMarketingSegmentList/cns:DatedMarketingSegment/cns:Dep/IATA_LocationCode`

10. **Start Terminal Information**
   - **Note**: Flight segment list does not exist in 21.3 response.

11. **Via Location Code**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/via/locationCode`
   - **Status**: To be checked.

12. **Via Start DateTime**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/via/startDateTime`
   - **Format**: YYYY-MM-DDTHH:MM:SS
   - **Status**: To be checked.

13. **Via End DateTime**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/via/endDateTime`
    - **Format**: YYYY-MM-DDTHH:MM:SS
    - **Status**: To be checked.

14. **Via Vehicle Code**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/via/vehicle/code`
    - **Status**: To be checked.

15. **Via Vehicle Description**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/via/vehicle/description`
    - **Status**: To be checked.

16. **End DateTime Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/end/dateTime`
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedMarketingSegmentList/cns:DatedMarketingSegment/cns:Arrival/cns:AircraftScheduledDateTime`

17. **End Location Code Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/end/locationCode`
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedMarketingSegmentList/cns:DatedMarketingSegment/cns:Arrival/cns:IATA_LocationCode`

18. **Flight Service Status Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/status`
   - **Source**: `IATA_OrderViewRS/Response/Order/OrderItem/Service/StatusCode`
   - **Description**: Map the status of the flight service based on the following codes:
     - **CANCELLED**: HX
     - **CONFIRMED**: HK
     - **REQUESTED**: HN
     - **TRANSFERRED**: NA
     - **WAITLISTED**: HL

### Specifications for EAI Product Data Mapping

19. **Total Passenger Count (NIP)**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/NIP`
   - **Description**: NIP is the total count of passengers excluding infants (PTCs for Infants: INF and ITF).


21. **Service Provider Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/serviceProvider/code`
   - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedMarketingSegmentList/cns:DatedMarketingSegment/cns:CarrierDesigCode`
   - **Description**: Map the service provider code.

22. **Operating Carrier Flight Number Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/identifier`
   - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedOperatingSegmentList/cns:DatedOperatingSegment/cns:OperatingCarrierFlightNumberText`
   - **Description**: Map the operating carrier flight number.

23. **Partner Service Provider Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/partnerInfo/serviceProvider/code`
   - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedOperatingSegmentList/cns:DatedOperatingSegment/cns:CarrierDesigCode`
   - **Description**: Map the partner service provider code.

25. **Partner Identifier Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/partnerInfo/identifier`
   - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedOperatingSegmentList/cns:DatedOperatingSegment/cns:OperatingCarrierFlightNumberText`
   - **Description**: Map the partner identifier.

26. **Vehicle Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/vehicle/code`
   - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedOperatingLegList/cns:DatedOperatingLeg/cns:CarrierAircraftType/cns:CarrierAircraftTypeCode`
   - **Description**: CarrierAircraftTypeCode is missing in TOVRS (PTR 27284937 [Medium]: NDCX:WS:TPS:X:VY:ORC:UAT).

28. **Duration Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/duration`
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedOperatingSegmentList/cns:DatedOperatingSegment/cns:Duration`
    - **Description**: Map the duration of the operating segment.

29. **Cabin Type Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/cabin`
    - **Source**: `IATA_OrderViewRS/Response/Order/OrderItem/FareDetail/FareComponent/CabinType/CabinTypeName`
    - **Description**: Map the cabin type.
   
### Specifications for Cabin Booking Class Mapping

30. **Cabin Booking Class Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EAI/Data/cabin/bkgClass`
   - **Source**: `IATA_OrderViewRS/Response/Order/OrderItem/FareDetail/FareComponent/CabinType/CabinTypeCode`
   - **Description**: Map the numerical cabin code values to their respective characters as follows:
     - **1** â†’ **F**: First Class
     - **2** â†’ **C**: Business Class
     - **3** â†’ **Y**: All Economy/Coach Class Category
     - **4** â†’ **W**: Economy/Coach Premium
     - **5** â†’ **M**: Economy/Coach
     - **6** â†’ **M**: Economy/Coach (Note: Shopping team suggests mapping cabin code 6 to M as only 1-5 cabin alpha codes are supported at shopping time.)

### Specifications for Extended Service Content Mapping

31. **Passenger Segment Reference ID Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/RefIDs`
   - **Source**: `IATA_OrderViewRS/Response/cns:Order/cns:OrderItem/cns:Service/cns:OrderServiceAssociation/cns:PaxSegmentRef/cns:PaxSegmentRefID`
   - **Example**: `<PaxSegmentRefID>seg0727697025</PaxSegmentRefID>`

32. **Dated Operating Leg Reference ID Mapping**
   - **Target**: `IATA_OrderViewRS/Response/cns:Order/cns:OrderItem/cns:Service/cns:OrderServiceAssociation/cns:DatedOperatingLegRef/cns:DatedOperatingLegRefID`
   - **Example**: `<DatedOperatingLegRefID>seg0484134592-leg0</DatedOperatingLegRefID>`
   - **Note**: Check if "-legX" exists, then remove it and map only the segment ID value (e.g., map to "seg0484134592").

33. **ESR ID Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ESR/ID`
   - **Source**: `IATA_OrderViewRS/Response/cns:Order/cns:OrderItem/cns:Service/cns:OrderServiceAssociation/cns:ServiceDefinitionRef/cns:ServiceDefinitionRefID`
   - **Note**: ESR node will be repeated for each Service ID. If multiple services exist, create multiple ESRs based on the following logic:
     - `IATA_OrderViewRS/Response/cns:Order/cns:OrderItem/cns:FareDetail` not present.
     - `IATA_OrderViewRS/Response/cns:Datalists/cns:ServiceDefinitionList/cns:ServiceDefinition/cns:ServiceDefinitionID` should equal `IATA_OrderViewRS/Response/cns:Order/cns:OrderItem/cns:Service/cns:OrderServiceAssociation/cns:ServiceDefinitionRef/cns:ServiceDefinitionRefID`.
     - `IATA_OrderViewRS/Response/cns:Order/cns:OrderItem/cns:Service/cns:OrderServiceAssociation/cns:SeatOnLeg` not present.

34. **Passenger Reference ID Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ESR/links`
   - **Source**: `IATA_OrderViewRS/Response/cns:Order/cns:OrderItem/cns:Service/cns:PaxRefID`
   - **Example**: `<PaxRefID>A172896031</PaxRefID>`

35. **NIP Encoding**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ESR/Data/NIP`
   - **Description**: Encode by counting the number of passengers associated with it.

36. **Service Status Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ESR/Data/status`
   - **Source**: `IATA_OrderViewRS/Response/cns:Order/cns:OrderItem/cns:Service/cns:StatusCode`
   - **Example**: `<StatusCode>CONFIRMED</StatusCode>`
   - **Value Mapping**:
     - CANCELLED â†’ HX
     - CONFIRMED â†’ HK
     - REQUESTED â†’ HN
     - TRANSFERRED â†’ NA
     - WAITLISTED â†’ HL

37. **Service Description Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ESR/Data/description`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/ServiceDefinitionList/ServiceDefinition/Name`
   - **Example**: `<Name>Luggage Pack</Name>`

38. **Price Category Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ESR/Data/priceCategory/code`
   - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:ServiceDefinitionList/cns:ServiceDefinition/cns:RFIC`
   - **Example**: `<RFIC>G</RFIC>`

39. **Price Category Subcode Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ESR/Data/priceCategory/subCode`
   - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:ServiceDefinitionList/cns:ServiceDefinition/cns:RFISC`
   - **Example**: `<RFISC>0L8</RFISC>`

40. **Product Description Text Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ESR/Data/productDescription/text`
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:ServiceDefinitionList/cns:ServiceDefinition/cns:Desc/cns:DescText`
    - **Example**: `<DescText>BG25</DescText>`
    - **Note**: If "FSR", "CSR", "Free", or "Chargeable" is received, do not map the entire `<Desc>` node.

41. **Product Description Text Type**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ESR/Data/productDescription/text/type`
    - **Status**: Not received in OVRS.

42. **Service Code Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ESR/Data/code`
    - **Source**: `IATA_OrderViewRS/Response/DataLists/ServiceDefinitionList/ServiceDefinition/ServiceCode`
    - **Example**: `<ServiceCode>VYOP</ServiceCode>`
    - **Note**: If SSR code is alphanumeric, hardcode to ASVC.

43. **Type Family**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ESR/Data/typeFamily`
    - **Status**: Not received in OVRS.

44. **Service Provider Code Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ESR/Data/serviceProvider/code`
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:DatedMarketingSegmentList/cns:DatedMarketingSegment/cns:CarrierDesigCode`
    - **Example**: `<CarrierDesigCode>VY</CarrierDesigCode>`
    - **Note**: Check if `OrderViewRS/Response/Order/OrderItem/Service/OrderServiceAssociation/ServiceDefinitionRef/OrderFlightAssociations/PaxSegmentRef/PaxSegmentRefID` matches with `OrderViewRS/Response/DataLists/PaxSegmentList/PaxSegment/PaxSegmentID`, then take `DatedMarketingSegmentRefId` from PaxSegment.

47. **External System Booking Reference Number**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ESR/Data/externalSystem/bkgReference/Number`
    - **Source**: 
      - `IATA_OrderViewRS/Response/Order/OrderID`
      - `IATA_OrderViewRS/Response/cns:Order/cns:OrderItem/cns:Service/cns:BookingRef/cns:BookingID`
      - `IATA_OrderViewRS/Response/Order/OrderItems/OrderItem/@OrderItemID`
      - `IATA_OrderViewRS/Response/Order/OrderItems/OrderItem/Service/@ServiceID`
    - **Example**: 
      - `<OrderID>YE4WSJ</OrderID>`
      - `<BookingID>YE4WSJ</BookingID>`
      - `<OrderItemID>YE4WSJ-BCNMAD-VY1002-ADT-FLIGHT</OrderItemID>`
      - `<ServiceID>s-BCNMAD-VY1002-A172896031-FLT</ServiceID>`
    - **Note**: OrderItem and ServiceID pertaining to AIR to be considered. BookingID to be considered for Airline Recloc.

48. **External System Booking Reference Owner**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/ESR/Data/externalSystem/bkgReference/Owner`
    - **Source**: `IATA_OrderViewRS/Response/cns:Order/cns:OrderItem/cns:OwnerCode`
    - **Note**: To be filled for OrderId, Airline Recloc, and OrderItemID only; not to be filled for ServiceID.
    - **Example**: `<OwnerCode>VY</OwnerCode>`

### Specifications for Extended Seat Content Mapping

50. **Passenger Segment Reference ID Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/RefIDs`
   - **Source**: `IATA_OrderViewRS/Response/Order/OrderItem/Service/OrderServiceAssociation/SeatOnLeg/SeatAssignmentAssociations/PaxSegmentRef/PaxSegmentRefID`

51. **Dummy Service Definition for Seat**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EST/ID`
   - **Description**: No service definition for Seat; create a dummy ServiceDefinition.

52. **Passenger Reference ID Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EST/links`
   - **Source**: `IATA_OrderViewRS/Response/Order/OrderItem/Service/PaxRefID`
   - **Description**: This will contain associated passengers for a given seat.

53. **Service Status Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EST/status`
   - **Source**: `IATA_OrderViewRS/Response/Order/OrderItem/Service/StatusCode`

54. **Service Code Hardcoding**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EST/Data/code`
   - **Value**: Hardcode with "RQST"
   - **Example**: "RQST"

55. **Service Status Code Mapping (Duplicate)**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EST/Data/status`
   - **Source**: `IATA_OrderViewRS/Response/Order/OrderItem/Service/StatusCode`

56. **Type Family Hardcoding**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EST/Data/typeFamily`
   - **Value**: Hardcoded with "SSR"

57. **Service Provider Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EST/Data/serviceProvider/code`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxSegmentList/PaxSegment/MarketingCarrierInfo/CarrierDesigCode`
   - **Description**: Check the flight segment associated with each SEAT and update the Operating Carrier or Marketing Carrier airline code (if Operating carrier code does not exist in provider response).

58. **External System Booking Reference Owner**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EST/Data/externalSystem/bkgReference/Owner`
   - **Source**: `IATA_OrderViewRS/Response/Order/OwnerCode`
   - **Note**: To be filled for OrderId, Airline Recloc, and OrderItemID only; not to be filled for ServiceID.
   - **Example**: `<OwnerCode>VY</OwnerCode>`

59. **External System Booking Reference Number**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EST/Data/externalSystem/bkgReference/Number`
    - **Targets**: 
      - `IATA_OrderViewRS/Response/Order/OrderID`
      - `IATA_OrderViewRS/Response/Order/BookingRef/BookingID`
      - `IATA_OrderViewRS/Response/Order/OrderItems/OrderItem/OrderItemID`
      - `IATA_OrderViewRS/Response/Order/OrderItems/OrderItem/Service/ServiceID`

60. **External System Booking Reference Additional Information**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EST/Data/externalSystem/bkgReference/additionalInformation`
    - **Fields**: 
      - OrderID
      - OrderItemID
      - ServiceID

61. **Seat Number Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EST/Data/seatNbr`
    - **Targets**: 
      - `IATA_OrderViewRS/Response/Order/OrderItem/Service/OrderServiceAssociation/SeatOnLeg/Seat/RowNumber`
      - `IATA_OrderViewRS/Response/Order/OrderItem/Service/OrderServiceAssociation/SeatOnLeg/Seat/ColumnID`

62. **Start Location Code Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/product/EST/Data/start/locationCode`
    - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxSegmentList/PaxSegment/Dep/IATA_LocationCode`
   
### Specifications for Payment Functions Mapping

1. **Method of Payment Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/formOfPayment/Data/Payment/MethodOfPayment/Code`
   - **Source**: `IATA_OrderViewRS/PaymentFunctions/cns:PaymentSupportedMethod/cns:PaymentTypeCode`
   - **Note**: Start numbering from 63.

2. **Payment Amount Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/formOfPayment/Data/Payment/PaymentInfo/Transaction/Value/Amount`
   - **Source**: `IATA_OrderViewRS/PaymentFunctions/cns:PaymentProcessingSummary/cns:Amount`

3. **Currency Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/formOfPayment/Data/Payment/PaymentInfo/Transaction/Value/CurrencyCode`
   - **Source**: `IATA_OrderViewRS/PaymentFunctions/cns:PaymentProcessingSummary/cns:Amount/@CurCode`

5. **Payment Status Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/formOfPayment/Data/Payment/PaymentInfo/Transaction/PaymentStatus`
   - **Source**: `IATA_OrderViewRS/PaymentFunctions/cns:PaymentProcessingSummary/cns:PaymentStatusCode`
   - **Note**: New tag to be created in AMA_CLRS.

### Specifications for Payment Functions - Credit Card Mapping and Surcharge Amounts

1. **Payment Card Brand Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Request/set/formOfPayment/Data/Payment/MethodofPayment/Card/Vendor/Code`
   - **Source**: `IATA_OrderViewRS/PaymentFunctions/cns:PaymentProcessingSummary/cns:PaymentProcessingSummaryPaymentMethod/cns:PaymentCard/cns:CardBrandCode`
   - **Mapping Details**:
     - **VY Credit Card Mapping**:
       - American Express: `AX` â†’ `AC`
       - Mastercard: `CA` â†’ `DM`
       - Visa: `VI` â†’ `VR`
       - Any other card: Send as is.
     - **NK Credit Card Mapping** (OPAC-1619):
       - American Express: `AX` â†’ `AX`
       - Mastercard: `CA` â†’ `MC`
       - Visa: `VI` â†’ `VI`
       - Any other card: Send as is.
     - **6E Credit Card Mapping**:
       - American Express: `AX` â†’ `AX`
       - Mastercard: `CA` â†’ `MC`
       - Visa: `VI` â†’ `VI`
       - Diners Club: `DC` â†’ `DC`
       - OX (OTA AX): Not yet implemented â†’ `OX`
       - OM (OTA OM): Not yet implemented â†’ `OM`
       - OV (OTA VI): Not yet implemented â†’ `OV`
       - Any other card: Send as is.

2. **Masked Card ID Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Request/set/formOfPayment/Data/Payment/MethodofPayment/Card/PrimaryAccount Number`
   - **Source**: `IATA_OrderViewRS/PaymentFunctions/cns:PaymentProcessingSummary/cns:PaymentProcessingSummaryPaymentMethod/cns:PaymentCard/cns:MaskedCardID`

3. **Surcharge Amount Mapping**
   - **Target**: `IATA_OrderViewRS/PaymentFunctions/cns:PaymentProcessingSummary/cns:SurchargeAmount`
   - **Description**: 
     - The surcharge amount returned in OrderViewRS is a credit card fee applied for credit card payments. The amount is computed at the Offer/Order level based on the total amount to be paid (not passenger or product related).
     - Indigo defines payment fees based on card type (debit, credit) and brand (Visa, Mastercard).
     - The surcharge amount is stored in the distribution PNR as an SVC element. To create an SVC element, CL creates an ESR node and OrderItem to store the surcharge amount.
   - **Implementation Details**:
     - A new EZT configuration (`Support_CC_Fees_Feature`) is introduced to control this feature. Possible values are:
       - `Support_CC_Fees_Feature 6E Y`
       - `Support_CC_Fees_Feature 6E N`
     - If the value is `Y` in EZT, CL checks if `SurchargeAmount` is returned in OrderViewRS. If yes, CL creates an ESR node with the required details (most SVC details are hardcoded) in AMA_CLRS and also an OrderItem associated with Service Definition in AMA_TOVRS.
   - **Further Details**: Please refer to the provided link for more information.

### Specifications for Time Limit Mapping

1. **PaymentTimeLimit Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/timelimit/paymentTimeLimit`
   - **Source**: `IATA_OrderViewRS/Response/Order/OrderItem/PaymentTimeLimitDateTime`
   - **Mapping Rules**:
     - **If the For VY**: 
       - The `PaymentTimeLimitDateTime` in CLRS should be mapped after reducing 50 minutes from the `PaymentTimeLimitDateTime` in OVRS.
       - **Example**:
         - OVRS: `2024-01-16T06:55:17Z`
         - CLRS: `2024-01-16T06:05:17Z`
       - Check if the `<FareDetail>` node is present (i.e., it is not a service). Only then, map `PaymentTimeLimitDateTime`. If it is a service, skip mapping `<PaymentTimeLimitDateTime>` for services in CLRS.
     - **For NK and 6E**: 
       - The `PaymentTimeLimitDateTime` in CLRS should be mapped as it is received from OVRS.

2. **Passenger Segment Reference ID Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/timelimit/RefIDs`
   - **Source**: `IATA_OrderViewRS/Response/Order/OrderItem/Service/OrderServiceAssociation/PaxSegmentRef/PaxSegmentRefID`

### Specifications for Passenger Details Mapping

1. **Passenger LastName Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/Name/LastName`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/Individual/Surname`

2. **Passenger FirstName Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/Name/FirstName`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/Individual/GivenName`

3. **Passenger Name Title Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/Name/Title`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/Individual/TitleName`

4. **Passenger ID Encoding**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/ID`
   - **Description**: Encode as `T<n>`; where `n` is the sequence number (same as input).

5. **Passenger TID Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/TID`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/PaxID`
   - **Description**: Encode with provider PAX ID (e.g., PAX2, PAX3, etc.).

6. **Gender Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/type`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/Individual/GenderCode`
   - **Mapping**:
     - 'M' â†’ 'Male'
     - 'F' â†’ 'Female'

7. **Date of Birth Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/DateOfBirth`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/Individual/Birthdate`

8. **PTC Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/PTC`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/PTC`
   - **Description**: Send the same PTC in AMA_CLRS as received in AMA_CLRQ request.

9. **Identity Document Reference Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/docRef`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/IdentityDoc/IdentityDocID`

10. **Identity Document Type Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/docRef/type`
    - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/IdentityDoc/IdentityDocTypeCode`
    - **Mapping**:
      - 'PT' â†’ 'P'
      - 'VI' â†’ 'V' (Visa is not supported by VY, NK, and 6E for now)

11. **Identity Document Issue Date Mapping**
    - **Target**: `IATA_OrderViewRS/Response/cns:DataLists/cns:PaxList/cns:Pax/cns:IdentityDoc/cns:IssueDate`

12. **Identity Document Issuer Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/docRef/issuer`
    - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/IdentityDoc/IssuingCountryCode`
    - **Description**: If a 3-letter country code is returned, convert it to a 2-letter country code.

13. **Nationality Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/docRef/nationality`
    - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/IdentityDoc/CitizenshipCountryCode`
    - **Description**: If a 3-letter country code is returned, convert it to a 2-letter country code.

14. **Identity Document Expiration Date Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/docRef/expirationDate`
    - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/IdentityDoc/ExpiryDate`

15. **Identity Document Date of Birth Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/docRef/dateOfBirth`
    - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/IdentityDoc/Birthdate`

16. **Residence Country Code Mapping**
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:PaxList/cns:Pax/cns:ResidenceCountryCode`

17. **Identity Document Middle Name Mapping**
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:PaxList/cns:Pax/cns:IdentityDoc/cns:MiddleName`

18. **Identity Document Gender Code Mapping**
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:PaxList/cns:Pax/cns:IdentityDoc/cns:GenderCode`

19. **Identity Document Given Name Mapping**
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:PaxList/cns:Pax/cns:IdentityDoc/cns:GivenName`

20. **Identity Document Surname Mapping**
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:PaxList/cns:Pax/cns:IdentityDoc/cns:Surname`

21. **Identity Document Title Name Mapping**
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:PaxList/cns:Pax/cns:IdentityDoc/cns:TitleName`

22. **Loyalty Program Company Code Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/loyalty/companyCode`
    - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/LoyaltyProgramAccount/LoyaltyProgram/Carrier/AirlineDesigCode`

23. **Loyalty Program Identifier Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/loyalty/identifier`
    - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/LoyaltyProgramAccount/AccountNumber`

25. **Identity Document Number Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/docRef`
    - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/IdentityDoc/IdentityDocumentNumber`

26. **Identity Document Type Code Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/docRef/type`
    - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/IdentityDocument/IdentityDocumentTypeCode`
    - **Mapping**:
      - 'PT' â†’ 'P'
      - 'VI' â†’ 'V'
      - 'AEA' â†’ 'R'
      - 'CR' â†’ 'K'

27. **Visa Issuance Date Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/docRef/visa/visaIssuanceDate`
    - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/IdentityDoc/IssueDate`

28. **Visa Issue Country Code Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/docRef/visa/visaIssueCountryCode`
    - **Source**: `IATA_OrderViewRS/Response/DataLists/PaxList/Pax/IdentityDoc/IssuingCountryCode`
    - **Description**: If a 3-letter country code is returned, convert it to a 2-letter country code.

29. **Identity Document Date of Birth Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/docRef/dateOfBirth`
    - **Source**: `OrderViewRS/Response/DataLists/PassengerList/Passenger/IdentityDoc/Birthdate`

### Specifications for Contact Info Mapping

1. **Contact Info ID Mapping**
   - **Source**: `IATA_OrderViewRS/Response/DataLists/ContactList/ContactInfo/ContactInfoID`
   - **Example**: e.g., `con-1`

3. **Address Line Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/address/line`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/ContactList/ContactInfo/PostalAddress/Street`

4. **Postal Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/address/zip`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/ContactList/ContactInfo/PostalAddress/PostalCode`

5. **City Name Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/address/cityName`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/ContactList/ContactInfo/PostalAddress/CityName`

6. **Country Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/address/countryCode`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/ContactList/ContactInfo/PostalAddress/CountryCode`
   - **Description**: If a 3-letter country code is returned, convert it to a 2-letter country code.

7. **Email Address Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/contact/email`
   - **Source**: `IATA_OrderViewRS/Response/DataLists/ContactList/ContactInfo/EmailAddress/EmailAddressText`

8. **Phone Type Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/contact/phone/type`
   - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:ContactInfoList/cns:ContactInfo/cns:Phone/cns:ContactTypeText`

9. **Phone Number Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/contact/phone`
   - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:ContactInfoList/cns:ContactInfo/cns:Phone/cns:PhoneNumber`

10. **Actor ID Encoding**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/ID`
    - **Description**: Encode as `T<n>`; where `n` is the sequence number.

11. **Actor TID Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/TID`
    - **Source**: `IATA_OrderViewRS/Response/cns:DataLists/cns:PaxList/cns:Pax/cns:PaxID`
    - **Description**: Encode with provider PAX ID.
   
### Specifications for Links Mapping

2. **ExternalContext ID Encoding**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/ExternalContext/ID`
   - **Description**: Encode as `EXT<sequence number>`.

3. **ExternalContext Reference Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/ExternalContext/reference`
   - **Source**: `IATA_OrderViewRS/Response/Order/OrderItem/OrderItemID`

4. **ExternalContext Type Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/ExternalContext/type`
   - **Value**: `OrderItem`

5. **ExternalContext Links Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/ExternalContext/links`
   - **Source**: `IATA_OrderViewRS/Response/cns:Order/cns:OrderItem/cns:FareDetail/cns:PaxRefID`
   - **Description**: There will be multiple fare details in the order item. Multiple PassengerRefs should be taken from all the FareDetail entries.

### Specifications for Links Mapping

2. **ExternalContext ID Encoding**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/ExternalContext/ID`
   - **Description**: Encode as `EXT<sequence number>`.

3. **ExternalContext Reference Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/ExternalContext/reference`
   - **Source**: `IATA_OrderViewRS/Response/Order/OrderItem/OrderItemID`

4. **ExternalContext Type Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/ExternalContext/type`
   - **Value**: `OrderItem`

5. **ExternalContext Links Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/set/ExternalContext/links`
   - **Source**: `IATA_OrderViewRS/Response/cns:Order/cns:OrderItem/cns:FareDetail/cns:PaxRefID`
   - **Description**: There will be multiple fare details in the order item. Multiple PassengerRefs should be taken from all the FareDetail entries.

### Specifications for Address with Addressee Name Mapping

1. **Company Name Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/address/companyName`
   - **Source**: `OrderViewRS/Response/DataLists/PaxList/Pax/Employer/Name`

2. **Addressee Name Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/address/addresseeName`
   - **Source**: `OrderViewRS/Response/DataLists/PaxList/Pax/Employer/SalesTaxRegistration/SalesTaxRegistrationID`

3. **Country Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/address/countryCode`
   - **Source**: `OrderViewRS/Response/DataLists/PaxList/Pax/Employer/SalesTaxRegistration/CountryCode`

4. **Address Line Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/address/line`
   - **Source**: `OrderViewRS/Response/DataLists/PaxList/Pax/Employer/SalesTaxRegistration/StreetText`

5. **Address Complement Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/address/complement`
   - **Source**: `OrderViewRS/Response/DataLists/PaxList/Pax/Employer/SalesTaxRegistration/StreetText`

6. **City Name Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/address/cityName`
   - **Source**: `OrderViewRS/Response/DataLists/PaxList/Pax/Employer/SalesTaxRegistration/CityName`

7. **Postal Code Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/address/zip`
   - **Source**: `OrderViewRS/Response/DataLists/PaxList/Pax/Employer/SalesTaxRegistration/PostalCode`

8. **Contact Type Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/contact/contactType`
   - **Description**: Hardcode as "GST" if the `addresseeName` node is present.

9. **Email Mapping**
   - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/contact/email`
   - **Source**: `AMA_ConnectivityLayerRS/Requests/Request/actor/contact/email`

10. **Phone Mapping**
    - **Target**: `AMA_ConnectivityLayerRS/Requests/Request/actor/contact/phone`
    - **Source**: `AMA_ConnectivityLayerRS/Requests/Request/actor/contact/phone`
    - **Description**: If multiple occurrences of `PhoneNumber` are received in OVRS, map them accordingly in CLRS.
    - **Example Structure**:
      ```xml
      <contact>
          <contactType>GST</contactType>
          <email>TESTGST-TEST@TEST.IN</email>
          <phone>0123456</phone>
          <phone>6543210</phone>
      </contact>
      ```